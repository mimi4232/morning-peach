<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë§ˆë¼í†¤ ì—¬í–‰ ë§¤ë‹ˆì € Pro</title>
    <style>
        :root {
            --primary: #3b82f6;     /* ì²´í¬ (íŒŒë‘) */
            --sched: #8b5cf6;       /* ì¼ì • (ë³´ë¼) */
            --money: #10b981;       /* ì •ì‚° (ì´ˆë¡) */
            --memo: #f59e0b;        /* ë©”ëª¨ (ì£¼í™©) */
            --bg: #f3f4f6;
            --card: #ffffff;
            --text: #1f2937;
            --gray: #9ca3af;
            --danger: #ef4444;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
            background-color: var(--bg);
            margin: 0; padding: 0;
            color: var(--text);
            height: 100vh;
            display: flex; flex-direction: column;
        }

        /* === ìƒë‹¨ í—¤ë” === */
        .header {
            background: var(--card);
            padding: 15px 15px 0 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            flex-shrink: 0; z-index: 10;
        }
        h1 { margin: 0 0 5px 0; font-size: 1.1rem; text-align: center; color: #111827; }
        .tabs { display: flex; gap: 0; margin-top: 10px; }
        .tab-btn {
            flex: 1; padding: 12px 0;
            border: none; background: none;
            font-weight: 600; font-size: 0.9rem; color: var(--gray);
            border-bottom: 3px solid transparent;
            cursor: pointer; transition: all 0.2s;
        }
        .tab-btn.active { color: var(--text); }
        .tab-btn[data-t="check"].active { color: var(--primary); border-color: var(--primary); }
        .tab-btn[data-t="sched"].active { color: var(--sched); border-color: var(--sched); }
        .tab-btn[data-t="money"].active { color: var(--money); border-color: var(--money); }
        .tab-btn[data-t="memo"].active { color: var(--memo); border-color: var(--memo); }

        /* === ë©”ì¸ ì»¨í…ì¸  === */
        .content {
            flex-grow: 1; overflow-y: auto;
            padding: 15px; padding-bottom: 140px; /* ì…ë ¥ì°½ ê³µê°„ í™•ë³´ */
        }
        .section { display: none; animation: fadeIn 0.2s; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* ê³µí†µ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .card {
            background: var(--card); border-radius: 12px;
            padding: 15px; margin-bottom: 10px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            position: relative;
        }
        .del-btn {
            position: absolute; top: 12px; right: 12px;
            background: none; border: none; color: #ffcccc;
            font-size: 1.2rem; line-height: 1; padding: 5px;
        }
        .del-btn:hover { color: var(--danger); }

        /* [1] ì²´í¬ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        .cat-title { font-weight: 800; color: #4b5563; margin: 25px 0 8px 5px; font-size: 1rem; display: flex; align-items: center; }
        .cat-title::before { content:''; width:4px; height:14px; background:var(--primary); margin-right:8px; border-radius:2px; }
        
        .check-row { display: flex; align-items: flex-start; cursor: pointer; }
        .checkbox {
            width: 20px; height: 20px; border: 2px solid #d1d5db; border-radius: 6px;
            margin-right: 12px; flex-shrink: 0; margin-top: 2px;
            display: flex; justify-content: center; align-items: center;
        }
        .checked .checkbox { background: var(--primary); border-color: var(--primary); }
        .checked .checkbox::after { content:'âœ“'; color:white; font-size:14px; }
        .check-text { font-size: 1rem; font-weight: 500; line-height: 1.4; }
        .check-note { font-size: 0.85rem; color: var(--gray); margin-top: 4px; word-break: break-all; }
        .check-note a { color: var(--primary); text-decoration: none; }
        .checked .check-text, .checked .check-note { text-decoration: line-through; color: #d1d5db; }

        /* [2] ì¼ì • ìŠ¤íƒ€ì¼ */
        .day-badge {
            display: inline-block; background: #ede9fe; color: var(--sched);
            font-weight: 800; font-size: 0.85rem; padding: 5px 12px;
            border-radius: 20px; margin: 20px 0 10px 0;
        }
        .sched-time { color: var(--sched); font-weight: 700; font-size: 0.9rem; margin-bottom: 4px; }
        .sched-title { font-weight: 600; font-size: 1.05rem; margin-bottom: 6px; }
        .sched-memo { font-size: 0.9rem; color: #666; background: #f9fafb; padding: 8px; border-radius: 6px; margin-bottom: 8px; }
        .map-btn {
            display: inline-block; background: #eff6ff; color: #2563eb;
            font-size: 0.8rem; font-weight: 600; padding: 6px 10px;
            border-radius: 6px; text-decoration: none;
        }

        /* [3] ì •ì‚° ìŠ¤íƒ€ì¼ */
        .money-summary {
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;
        }
        .sum-box {
            background: white; padding: 15px; border-radius: 12px; text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .sum-label { font-size: 0.8rem; color: #666; margin-bottom: 4px; }
        .sum-val { font-weight: 800; font-size: 1.2rem; }
        .sum-val.total { color: var(--money); }
        .sum-val.unsettled { color: var(--danger); }

        .money-card { display: flex; justify-content: space-between; align-items: center; }
        .money-left { flex-grow: 1; }
        .money-desc { font-weight: 600; font-size: 1rem; }
        .money-meta { font-size: 0.8rem; color: #888; margin-top: 4px; }
        .badge { font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; margin-right: 5px; }
        .badge.card { background: #e0f2fe; color: #0284c7; }
        .badge.cash { background: #dcfce7; color: #16a34a; }
        
        .money-right { text-align: right; min-width: 80px; }
        .money-amt { font-weight: 700; font-size: 1.1rem; color: #333; display: block; margin-bottom: 5px;}
        .settle-check {
            font-size: 0.8rem; color: #666; display: flex; align-items: center; justify-content: flex-end; cursor: pointer;
        }
        .settle-check input { margin-right: 5px; }

        /* [4] ë©”ëª¨ ìŠ¤íƒ€ì¼ */
        .memo-card { min-height: 80px; }
        .memo-date { font-size: 0.75rem; color: #aaa; margin-bottom: 8px; text-align: right;}
        .memo-content { white-space: pre-wrap; line-height: 1.5; }

        /* === í•˜ë‹¨ ì…ë ¥ì°½ (Dock) === */
        .dock {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: white; padding: 15px; z-index: 100;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.08);
        }
        .input-group { display: none; flex-direction: column; gap: 8px; }
        .input-group.active { display: flex; }
        .row { display: flex; gap: 8px; }
        
        input, select, textarea {
            padding: 10px; border: 1px solid #e5e7eb; border-radius: 8px;
            font-size: 1rem; outline: none; background: #f9fafb;
        }
        input:focus, textarea:focus { background: white; border-color: #999; }
        .grow { flex-grow: 1; }
        
        .add-btn {
            background: #111827; color: white; border: none;
            padding: 0 15px; border-radius: 8px; font-weight: bold;
            cursor: pointer; height: 42px;
        }
        /* íƒ­ë³„ ë²„íŠ¼ ìƒ‰ìƒ */
        .btn-check { background: var(--primary); }
        .btn-sched { background: var(--sched); }
        .btn-money { background: var(--money); }
        .btn-memo { background: var(--memo); }

    </style>
</head>
<body>

<div class="header">
    <h1>âœˆï¸ ë§ˆë¼í†¤ ì—¬í–‰ ë§¤ë‹ˆì € Pro</h1>
    <div class="tabs">
        <button class="tab-btn active" data-t="check" onclick="setTab('check')">ì²´í¬</button>
        <button class="tab-btn" data-t="sched" onclick="setTab('sched')">ì¼ì •</button>
        <button class="tab-btn" data-t="money" onclick="setTab('money')">ì •ì‚°</button>
        <button class="tab-btn" data-t="memo" onclick="setTab('memo')">ë©”ëª¨</button>
    </div>
</div>

<div class="content">
    <div id="view-check" class="section active">
        <div style="background:var(--primary); color:white; padding:12px; border-radius:10px; margin-bottom:15px; font-weight:bold; text-align:center;">
            ì¤€ë¹„ ì™„ë£Œìœ¨: <span id="prog-txt">0%</span>
        </div>
        <div id="list-check"></div>
    </div>

    <div id="view-sched" class="section">
        <div id="list-sched"></div>
        <div style="text-align:center; margin-top:30px; color:#aaa; font-size:0.8rem;">
            ì¼ì • ì œëª©ì´ êµ¬ê¸€ë§µ ê²€ìƒ‰ì–´(ë§í¬)ê°€ ë©ë‹ˆë‹¤.
        </div>
    </div>

    <div id="view-money" class="section">
        <div class="money-summary">
            <div class="sum-box">
                <div class="sum-label">ì´ ì§€ì¶œ</div>
                <div class="sum-val total" id="sum-total">0</div>
            </div>
            <div class="sum-box">
                <div class="sum-label">ì •ì‚° ì•ˆ ëœ ê¸ˆì•¡</div>
                <div class="sum-val unsettled" id="sum-left">0</div>
            </div>
        </div>
        <div id="list-money"></div>
    </div>

    <div id="view-memo" class="section">
        <div id="list-memo"></div>
        <div style="text-align:center; margin-top:50px; color:#ccc;">ììœ ë¡­ê²Œ ê¸°ë¡í•˜ì„¸ìš”</div>
    </div>
</div>

<div class="dock">
    <div id="in-check" class="input-group active">
        <div class="row">
            <select id="c-cat" style="width:35%"><option>ì¶œêµ­ ì „</option><option>ë¶€ëª¨ë‹˜</option><option>ë‚˜</option><option>ê¸°íƒ€</option></select>
            <input type="text" id="c-txt" class="grow" placeholder="ì¤€ë¹„ë¬¼ ì´ë¦„">
        </div>
        <div class="row">
            <input type="text" id="c-note" class="grow" placeholder="ë©”ëª¨/ë§í¬ (ì„ íƒ)">
            <button class="add-btn btn-check" onclick="addCheck()">ì¶”ê°€</button>
        </div>
    </div>

    <div id="in-sched" class="input-group">
        <div class="row">
            <select id="s-day" style="width:30%"><option value="1">1ì¼ì°¨</option><option value="2">2ì¼ì°¨</option><option value="3">3ì¼ì°¨</option></select>
            <input type="text" id="s-time" style="width:30%" placeholder="14:00">
            <input type="text" id="s-title" class="grow" placeholder="ì¼ì •ëª…(ì¥ì†Œ)">
        </div>
        <div class="row">
            <input type="text" id="s-memo" class="grow" placeholder="ë©”ëª¨ (ì˜ˆ: 10ë¶„ ì†Œìš”, í™˜ì „í•˜ê¸°)">
            <button class="add-btn btn-sched" onclick="addSched()">ë“±ë¡</button>
        </div>
    </div>

    <div id="in-money" class="input-group">
        <div class="row">
            <select id="m-day" style="width:30%"><option>ì¶œêµ­ ì „</option><option>1ì¼ì°¨</option><option>2ì¼ì°¨</option><option>3ì¼ì°¨</option></select>
            <select id="m-method" style="width:30%"><option>ì¹´ë“œ</option><option>í˜„ê¸ˆ</option><option>ê³µê¸ˆ</option></select>
            <input type="number" id="m-amt" class="grow" placeholder="ê¸ˆì•¡">
        </div>
        <div class="row">
            <input type="text" id="m-desc" class="grow" placeholder="ë‚´ì—­ (ì˜ˆ: í¸ì˜ì )">
            <button class="add-btn btn-money" onclick="addMoney()">ì…ë ¥</button>
        </div>
    </div>

    <div id="in-memo" class="input-group">
        <div class="row">
            <textarea id="memo-txt" class="grow" rows="2" placeholder="ì—¬ê¸°ì— ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
            <button class="add-btn btn-memo" style="height:auto;" onclick="addMemo()">ê¸°ë¡</button>
        </div>
    </div>
</div>

<script>
    // Data Store
    const DB = {
        check: [], sched: [], money: [], memo: []
    };

    // Load Data
    function load() {
        const d = localStorage.getItem('mara_pro_v1');
        if(d) {
            const parsed = JSON.parse(d);
            Object.assign(DB, parsed);
        } else {
            // ê¸°ë³¸ ë°ì´í„°
            DB.check = [
                {id:1, cat:"ì¶œêµ­ ì „", txt:"ì—¬í–‰ì ë³´í—˜", note:"ë¶€ëª¨ë‹˜ ê²ƒê¹Œì§€ ê¼­ í™•ì¸", ok:false},
                {id:2, cat:"ëŸ¬ë„ˆ(ë¶€ëª¨ë‹˜)", txt:"ë°°ë²ˆí˜¸ & ì˜·í•€", note:"ê°€ì¥ ì¤‘ìš”í•¨!", ok:false}
            ];
            save();
        }
        renderAll();
    }
    function save() {
        localStorage.setItem('mara_pro_v1', JSON.stringify(DB));
    }

    // íƒ­ ì „í™˜
    function setTab(t) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.toggle('active', b.dataset.t === t));
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById('view-'+t).classList.add('active');
        document.querySelectorAll('.input-group').forEach(g => g.classList.remove('active'));
        document.getElementById('in-'+t).classList.add('active');
    }

    // =========================
    // 1. ì²´í¬ë¦¬ìŠ¤íŠ¸ ë¡œì§
    // =========================
    function addCheck() {
        const cat = document.getElementById('c-cat').value;
        const txt = document.getElementById('c-txt').value.trim();
        const note = document.getElementById('c-note').value.trim();
        if(!txt) return;
        DB.check.push({id:Date.now(), cat, txt, note, ok:false});
        document.getElementById('c-txt').value=''; document.getElementById('c-note').value='';
        save(); renderCheck();
    }
    function renderCheck() {
        const con = document.getElementById('list-check'); con.innerHTML = '';
        const cats = {};
        // ì¹´í…Œê³ ë¦¬ë³„ ë¶„ë¥˜
        DB.check.forEach(i => { if(!cats[i.cat]) cats[i.cat]=[]; cats[i.cat].push(i); });
        
        // í™”ë©´ ê·¸ë¦¬ê¸°
        for(const c in cats) {
            const h = document.createElement('div'); h.className='cat-title'; h.innerText=c; con.appendChild(h);
            cats[c].forEach(i => {
                const d = document.createElement('div'); d.className='card';
                if(i.ok) d.classList.add('checked');
                
                // ë§í¬ ìë™ ë³€í™˜ ë¡œì§
                let noteHtml = i.note;
                if(i.note && i.note.startsWith('http')) {
                    noteHtml = `<a href="${i.note}" target="_blank">ğŸ”— ë§í¬ ì—´ê¸°</a>`;
                }

                d.innerHTML = `
                    <div class="check-row" onclick="toggleCheck(${i.id})">
                        <div class="checkbox"></div>
                        <div>
                            <div class="check-text">${i.txt}</div>
                            ${i.note ? `<div class="check-note">${noteHtml}</div>` : ''}
                        </div>
                    </div>
                    <button class="del-btn" onclick="del('check', ${i.id})">Ã—</button>
                `;
                con.appendChild(d);
            });
        }
        // ì§„í–‰ë¥ 
        const tot = DB.check.length;
        const done = DB.check.filter(i=>i.ok).length;
        document.getElementById('prog-txt').innerText = tot===0 ? "0%" : Math.round((done/tot)*100)+"%";
    }
    function toggleCheck(id) {
        const i = DB.check.find(x=>x.id===id); if(i){ i.ok=!i.ok; save(); renderCheck(); }
    }

    // =========================
    // 2. ì¼ì • ë¡œì§
    // =========================
    function addSched() {
        const day = document.getElementById('s-day').value;
        const time = document.getElementById('s-time').value;
        const title = document.getElementById('s-title').value.trim();
        const memo = document.getElementById('s-memo').value.trim();
        if(!title) return;
        DB.sched.push({id:Date.now(), day, time, title, memo});
        document.getElementById('s-title').value=''; document.getElementById('s-memo').value='';
        save(); renderSched();
    }
    function renderSched() {
        const con = document.getElementById('list-sched'); con.innerHTML = '';
        const days = ["1","2","3"];
        days.forEach(d => {
            const list = DB.sched.filter(i=>i.day===d).sort((a,b)=>a.time.localeCompare(b.time));
            if(list.length > 0) {
                const h = document.createElement('div'); h.className='day-badge'; h.innerText=`Day ${d}`; con.appendChild(h);
                list.forEach(i => {
                    const mapUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(i.title)}`;
                    const el = document.createElement('div'); el.className='card';
                    el.innerHTML = `
                        <div class="sched-time">${i.time || '--:--'}</div>
                        <div class="sched-title">${i.title}</div>
                        ${i.memo ? `<div class="sched-memo">ğŸ“ ${i.memo}</div>` : ''}
                        <a href="${mapUrl}" target="_blank" class="map-btn">ğŸ“ ì§€ë„ ë³´ê¸°</a>
                        <button class="del-btn" onclick="del('sched', ${i.id})">Ã—</button>
                    `;
                    con.appendChild(el);
                });
            }
        });
    }

    // =========================
    // 3. ì •ì‚° ë¡œì§
    // =========================
    function addMoney() {
        const day = document.getElementById('m-day').value;
        const method = document.getElementById('m-method').value;
        const amt = document.getElementById('m-amt').value;
        const desc = document.getElementById('m-desc').value.trim();
        if(!amt || !desc) return;
        DB.money.push({id:Date.now(), day, method, amt:Number(amt), desc, settled:false});
        document.getElementById('m-amt').value=''; document.getElementById('m-desc').value='';
        save(); renderMoney();
    }
    function renderMoney() {
        const con = document.getElementById('list-money'); con.innerHTML = '';
        
        let total = 0;
        let left = 0;
        
        // ì¼ìë³„ ê·¸ë£¹í•‘ (ì…ë ¥ ì—­ìˆœ)
        const list = [...DB.money].sort((a,b)=>b.id-a.id);
        const groups = {};
        list.forEach(i => { if(!groups[i.day]) groups[i.day]=[]; groups[i.day].push(i); });
        
        // ê³„ì‚° ë° ë Œë”ë§
        for(const day in groups) {
            const h = document.createElement('div'); 
            h.style.marginTop='20px'; h.style.fontWeight='bold'; h.style.color='#666'; h.innerText=day;
            con.appendChild(h);

            groups[day].forEach(i => {
                total += i.amt;
                if(!i.settled) left += i.amt;

                const el = document.createElement('div'); el.className='card money-card';
                const badgeClass = i.method==='ì¹´ë“œ'?'card':'cash';
                el.innerHTML = `
                    <div class="money-left">
                        <div class="money-desc">${i.desc}</div>
                        <div class="money-meta">
                            <span class="badge ${badgeClass}">${i.method}</span>
                        </div>
                    </div>
                    <div class="money-right">
                        <span class="money-amt">${i.amt.toLocaleString()}</span>
                        <label class="settle-check">
                            <input type="checkbox" ${i.settled?'checked':''} onchange="toggleSettle(${i.id})"> ì •ì‚°ì™„ë£Œ
                        </label>
                    </div>
                    <button class="del-btn" style="top:5px; right:5px; font-size:1rem;" onclick="del('money', ${i.id})">Ã—</button>
                `;
                con.appendChild(el);
            });
        }
        
        document.getElementById('sum-total').innerText = total.toLocaleString();
        document.getElementById('sum-left').innerText = left.toLocaleString();
    }
    function toggleSettle(id) {
        const i = DB.money.find(x=>x.id===id); if(i){ i.settled=!i.settled; save(); renderMoney(); }
    }

    // =========================
    // 4. ë©”ëª¨ ë¡œì§
    // =========================
    function addMemo() {
        const txt = document.getElementById('memo-txt').value.trim();
        if(!txt) return;
        const date = new Date().toLocaleString('ko-KR', {month:'numeric', day:'numeric', hour:'2-digit', minute:'2-digit'});
        DB.memo.push({id:Date.now(), txt, date});
        document.getElementById('memo-txt').value='';
        save(); renderMemo();
    }
    function renderMemo() {
        const con = document.getElementById('list-memo'); con.innerHTML = '';
        [...DB.memo].sort((a,b)=>b.id-a.id).forEach(i => {
            const d = document.createElement('div'); d.className='card memo-card';
            d.innerHTML = `
                <div class="memo-date">${i.date}</div>
                <div class="memo-content">${i.txt}</div>
                <button class="del-btn" onclick="del('memo', ${i.id})">Ã—</button>
            `;
            con.appendChild(d);
        });
    }

    // ê³µí†µ ì‚­ì œ
    function del(type, id) {
        if(confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            DB[type] = DB[type].filter(x => x.id !== id);
            save(); renderAll();
        }
    }
    function renderAll() { renderCheck(); renderSched(); renderMoney(); renderMemo(); }

    window.onload = load;

</script>
</body>
</html>
